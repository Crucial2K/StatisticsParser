<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Statistics IO Parser</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" />
    <link href="assets/css/style.css" rel="stylesheet">
    <link href="assets/css/DT_bootstrap.css" rel="stylesheet" />
    <style>
        body {
            padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
        }
    </style>

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../assets/js/html5shiv.js"></script>
    <![endif]-->

</head>

<body>

    <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="navbar-inner">
            <div class="container">
                <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="brand" href="#">Statistics IO Parser</a>
                <div class="nav-collapse collapse">
                    <ul class="nav">
                        <li class="active"><a href="#">Home</a></li>
                        <li><a href="about.html">About</a></li>
                    </ul>
                    <ul class="nav pull-right">
                        <li><a href="http://jorriss.net">Jorriss.net</a></li>
                    </ul>
                </div>
                <!--/.nav-collapse -->
            </div>
        </div>
    </div>

    <div class="container">

        <h1>Statistics IO Parser</h1>
        <p>
            Sometimes reading the ouput from Statistics IO can be a total drag.
            <br />
            This page will help with that. Just paste in the output of of Statistics IO
            <br />
            and press Parse. Your output will be formatted and totaled. Enjoy.
        </p>

        <form>
            <p>
                <div>
                    <label class="checkbox pull-right">
                        <input type="checkbox" id="exampleCheck" value="" onclick="includeExample(exampleCheck.checked)">
                        Show Example Statistics IO Output
                    </label>
                </div>
                <textarea id='statiotext' rows="10"></textarea>
            </p>
            <button type="button" onclick="parseText();">Parse</button>

        </form>

        <p></p>
        <div id="resultTotal"></div>
        <div id='result'></div>

        <script>

            function includeExample(value) {
                var txt = document.getElementById("statiotext");
                if (value == true) {
                    txt.value = "Table 'sysobjrdb'. Scan count 0, logical reads 2, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'sysschobjs'. Scan count 0, logical reads 2, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'Worktable'. Scan count 0, logical reads 0, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'sysobjrdb'. Scan count 0, logical reads 2, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'spt_values'. Scan count 1, logical reads 3, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'sysschobjs'. Scan count 0, logical reads 2, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'Worktable'. Scan count 0, logical reads 0, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'syscolpars'. Scan count 1, logical reads 2, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'syscolrdb'. Scan count 1, logical reads 2, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'syscolpars'. Scan count 1, logical reads 2, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'syscolpars'. Scan count 1, logical reads 2, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'syscolpars'. Scan count 1, logical reads 2, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'syscolrdb'. Scan count 1, logical reads 2, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'syscolpars'. Scan count 1, logical reads 2, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'sysschobjs'. Scan count 0, logical reads 2, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'sysclsobjs'. Scan count 0, logical reads 2, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'sysidxstats'. Scan count 1, logical reads 2, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'Worktable'. Scan count 0, logical reads 8, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'sysidxstats'. Scan count 1, logical reads 12, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'Worktable'. Scan count 0, logical reads 2, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'sysclsobjs'. Scan count 0, logical reads 2, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable '#spindtab___________________________________________________________________________________________________________000000001259'. Scan count 0, logical reads 1, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'Worktable'. Scan count 0, logical reads 2, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'sysclsobjs'. Scan count 0, logical reads 2, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable '#spindtab___________________________________________________________________________________________________________000000001259'. Scan count 0, logical reads 1, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'Worktable'. Scan count 0, logical reads 2, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'sysclsobjs'. Scan count 0, logical reads 2, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable '#spindtab___________________________________________________________________________________________________________000000001259'. Scan count 0, logical reads 1, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'Worktable'. Scan count 0, logical reads 2, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'sysclsobjs'. Scan count 0, logical reads 2, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable '#spindtab___________________________________________________________________________________________________________000000001259'. Scan count 0, logical reads 1, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'Worktable'. Scan count 0, logical reads 2, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable '#spindtab___________________________________________________________________________________________________________000000001259'. Scan count 1, logical reads 1, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'Worktable'. Scan count 0, logical reads 3, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'sysschobjs'. Scan count 1, logical reads 3, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'Worktable'. Scan count 0, logical reads 2, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'sysidxstats'. Scan count 0, logical reads 4, physical reads 1, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable '#spcnsttab__________________________________________________________________________________________________________00000000125A'. Scan count 0, logical reads 1, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'Worktable'. Scan count 0, logical reads 2, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable '#spcnsttab__________________________________________________________________________________________________________00000000125A'. Scan count 0, logical reads 0, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'Worktable'. Scan count 1, logical reads 0, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'Worktable'. Scan count 0, logical reads 0, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'sysobjvalues'. Scan count 1, logical reads 2, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'syscolpars'. Scan count 2, logical reads 14, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'sysschobjs'. Scan count 1, logical reads 3, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable '#spcnsttab__________________________________________________________________________________________________________00000000125A'. Scan count 0, logical reads 0, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'Worktable'. Scan count 1, logical reads 0, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'Worktable'. Scan count 0, logical reads 0, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'Worktable'. Scan count 0, logical reads 0, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'syscolpars'. Scan count 1, logical reads 2, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable '#spcnsttab__________________________________________________________________________________________________________00000000125A'. Scan count 1, logical reads 1, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable '#spcnsttab__________________________________________________________________________________________________________00000000125A'. Scan count 1, logical reads 1, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'Worktable'. Scan count 0, logical reads 0, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'syssingleobjrefs'. Scan count 1, logical reads 2, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nNo foreign keys reference table 'Person', or you do not have permissions on referencing tables.\nTable 'sysobjvalues'. Scan count 1, logical reads 2, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'sysmultiobjrefs'. Scan count 1, logical reads 2, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nNo views with schema binding reference table 'Person'.";
                } else {
                    txt.value = "";
                }
            }

            function Info(table, scan, logical, physical, readahead, loblogical, lobphysical, lobreadahead) {
                this.table = table;
                this.nostats = false;
                this.scan = infoReplace(scan, 'Scan count ', '');
                this.logical = infoReplace(logical, 'logical reads ', '');
                this.physical = infoReplace(physical, 'physical reads ', '');
                this.readahead = infoReplace(readahead, 'read-ahead reads ', '');
                this.loblogical = infoReplace(loblogical, 'lob logical reads ', '');
                this.lobphysical = infoReplace(lobphysical, 'lob physical reads ', '');
                this.lobreadahead = infoReplace(lobreadahead, 'lob read-ahead reads ', '');
                this.percentread = 0.0;
            }

            function InfoTotal() {
                this.table = '';
                this.scan = 0;
                this.logical = 0;
                this.physical = 0;
                this.readahead = 0;
                this.loblogical = 0;
                this.lobphysical = 0;
                this.lobreadahead = 0;
                this.percentread = 0.0;
            }

            function infoReplace(strValue, searchValue, newvValue) {
                var returnValue = 0;
                if (strValue != undefined) {
                    returnValue = parseInt(strValue.replace(searchValue, newvValue));
                    if (isNaN(returnValue)) {
                        returnValue = 0;
                    }
                }
                return returnValue;
            }

            function parseText() {
                var txt = document.getElementById("statiotext").value;
                var lines = txt.split('\n');
                var result = new Array();

                for (var i = 0; i < lines.length; i++) {
                    var line = lines[i];
                    var section = line.split('\.');

                    var tableName = getSubStr(section[0], '\'')

                    var tableData = section[1];

                    if (tableData != undefined) {
                        if (tableData == '') {
                            var statLineInfo = new Info(line);
                            statLineInfo.nostats = true;
                            result.push(statLineInfo);
                        }
                        var stat = tableData.split(/[,]+/);
                        var statInfo = new Info(tableName, stat[0], stat[1], stat[2], stat[3], stat[4], stat[5], stat[6]);
                        result.push(statInfo);
                    } else {
                        if (line.length > 0) {
                            var statLineInfo = new Info(line);
                            statLineInfo.nostats = true;
                            result.push(statLineInfo);
                        }
                    }
                }
                output(result, calcTotals(result));

                //Apply datatables plugin
               $('#resultTable').dataTable({
                    "sDom": "t",
                    "bFilter": false,
                    "bPaginate": false
                });
            }

            function calcTotals(statInfos) {
                var statTotal = new InfoTotal();

                for (var i = 0; i < statInfos.length; i++) {
                    statTotal.scan += statInfos[i].scan;
                    statTotal.logical += statInfos[i].logical;
                    statTotal.physical += statInfos[i].physical;
                    statTotal.readahead += statInfos[i].readahead;
                    statTotal.loblogical += statInfos[i].loblogical;
                    statTotal.lobphysical += statInfos[i].lobphysical;
                    statTotal.lobreadahead += statInfos[i].lobreadahead;
                }
                calcPercent(statInfos, statTotal);
                return statTotal;
            }

            function calcPercent(statInfos, statTotal) {
                for (var i = 0; i < statInfos.length; i++) {
                    statInfos[i].percentread = ((statInfos[i].logical / statTotal.logical) * 100).toFixed(3);
                    //statInfos[i].percentread += statInfos[i].percentread.toString() + '%';
                }
            }

            function output(statInfo, statTotal) {
                var result = '<table id="resultTable" class="table table-striped table-hover table-condensed" style="table-layout:fixed">';
                result += '<thead><tr>';
                result += '<th class="th-column">Table</th>';
                result += '<th width="50" class="th-column">Scan Count</th>';
                result += '<th width="50" class="th-column">Logical Reads</th>';
                result += '<th width="50" class="th-column">Physical Reads</th>';
                result += '<th width="50" class="th-column">Read-Ahead Reads</th>';
                result += '<th width="50" class="th-column">LOB Logical Reads</th>';
                result += '<th width="50" class="th-column">LOB Physical Reads</th>';
                result += '<th width="50" class="th-column">LOB Read-Ahead Reads</th>';
                result += '<th width="75" class="th-column">% Logical Reads of Total Reads</th>';
                result += '</tr></thead>';
                result += '<tbody>';
                for (var i = 0; i < statInfo.length; i++) {
                    result += '<tr>';

                    result += '<td>' + statInfo[i].table + '</td>';
                    if (statInfo[i].nostats) {
                        result += '<td>N/A</td>';
                        result += '<td>N/A</td>';
                        result += '<td>N/A</td>';
                        result += '<td>N/A</td>';
                        result += '<td>N/A</td>';
                        result += '<td>N/A</td>';
                        result += '<td>N/A</td>';
                        result += '<td>N/A</td>';
                    } else {
                        result += '<td>' + statInfo[i].scan + '</td>';
                        result += '<td>' + statInfo[i].logical + '</td>';
                        result += '<td>' + statInfo[i].physical + '</td>';
                        result += '<td>' + statInfo[i].readahead + '</td>';
                        result += '<td>' + statInfo[i].loblogical + '</td>';
                        result += '<td>' + statInfo[i].lobphysical + '</td>';
                        result += '<td>' + statInfo[i].lobreadahead + '</td>';
                        result += '<td>' + statInfo[i].percentread + '%</td>';
                    }
                    result += '</tr>';
                }
                result += '</tbody>';
               /* result += '<tfoot><tr>';
                result += '<td class="footer-column">Total</td>';
                result += '<td class="footer-column">' + statTotal.scan + '</td>';
                result += '<td class="footer-column">' + statTotal.logical + '</td>';
                result += '<td class="footer-column">' + statTotal.physical + '</td>';
                result += '<td class="footer-column">' + statTotal.readahead + '</td>';
                result += '<td class="footer-column">' + statTotal.loblogical + '</td>';
                result += '<td class="footer-column">' + statTotal.lobphysical + '</td>';
                result += '<td class="footer-column">' + statTotal.lobreadahead + '</td>';
                result += '<td class="footer-column">&nbsp;</td>';
                result += '</tr></tfoot>';*/

                result += '</table>'
                document.getElementById("result").innerHTML = result;
            }

            function getSubStr(str, delim) {
                var a = str.indexOf(delim);

                if (a == -1)
                    return '';

                var b = str.indexOf(delim, a + 1);

                if (b == -1)
                    return '';

                return str.substr(a + 1, b - a - 1);
            }
        </script>
    </div>
    <!-- /container -->

    <footer class="footer">
        <div class="container">
            <p>Built and maintained by Richie Rump (<a href="http://www.jorriss.net">blog</a> | <a href="http://twitter.com/jorriss">twitter</a>) and the fine folks at Jorriss LLC.</p>
        </div>
    </footer>
    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!--
    <script src="../assets/js/bootstrap-transition.js"></script>
    <script src="../assets/js/bootstrap-alert.js"></script>
    <script src="../assets/js/bootstrap-modal.js"></script>
    <script src="../assets/js/bootstrap-dropdown.js"></script>
    <script src="../assets/js/bootstrap-scrollspy.js"></script>
    <script src="../assets/js/bootstrap-tab.js"></script>
    <script src="../assets/js/bootstrap-tooltip.js"></script>
    <script src="../assets/js/bootstrap-popover.js"></script>
    <script src="../assets/js/bootstrap-button.js"></script>
    <script src="../assets/js/bootstrap-collapse.js"></script>
    <script src="../assets/js/bootstrap-carousel.js"></script>
    -->
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/jquery.js"></script>
    <script src="assets/js/jquery.dataTables.js"></script>
    <script src="assets/js/DT_bootstrap.js"></script>
</body>
</html>


